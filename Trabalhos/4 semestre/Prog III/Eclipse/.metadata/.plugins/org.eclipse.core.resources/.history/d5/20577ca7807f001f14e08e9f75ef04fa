package Agenda;

import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import net.miginfocom.swing.MigLayout;
import java.util.LinkedList;

public class Consulta extends JPanel {

    private JTable table;
    private DefaultTableModel model;
    private LinkedList<Contato> contatos;

    public Consulta() {
        setLayout(new MigLayout("", "[87.00px][350.00,grow][grow,right]", "[][446px]"));

        contatos = carregarContatos();

        model = new DefaultTableModel(new Object[]{"Nome", "Apelido", "Email", "Telefone"}, 0);
        table = new JTable(model);

        for (Contato contato : contatos) {
            model.addRow(new Object[]{contato.getNome(), contato.getApelido(), contato.getEmail(), contato.getNumero()});
        }

        JLabel label = new JLabel("Buscar por nome:");
        add(label, "cell 0 0,alignx left");

        JTextField buscaField = new JTextField(15);
        add(buscaField, "cell 1 0,growx");

        JButton buscarButton = new JButton("Buscar");
        add(buscarButton, "cell 2 0,alignx right");
        buscarButton.addActionListener(e -> buscarContato(buscaField.getText()));

        add(new JScrollPane(table), "cell 0 1 3 1,grow");
    }

    private LinkedList<Contato> carregarContatos() {
        Arquivo a = new Arquivo("agenda");
        return a.ler();
    }

    private void buscarContato(String nome) {
        model.setRowCount(0); 
        for (Contato contato : contatos) {
            if (contato.getNome().toLowerCase().contains(nome.toLowerCase())) {
                model.addRow(new Object[]{contato.getNome(), contato.getApelido(), contato.getEmail(), contato.getNumero()});
            }
        }
        if (model.getRowCount() == 0) {
            JOptionPane.showMessageDialog(this, "Contato não encontrado.");
        }
    }
	public void voltar() {
		Menu.frame.setContentPane(new Inicio());
		Menu.frame.setVisible(true);
	}
}
